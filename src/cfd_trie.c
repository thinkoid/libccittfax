/* -*- mode: c; -*- */

#include <assert.h>

#include "cfd_trie.h"

enum cfd_trie_type_t { CFD_TRIE_NONE = 0, CFD_TRIE_NODE, CFD_TRIE_LEAF };

union cfd_trie_any_t {
        struct init_t { int a, b, c; } init;

        int type;

        struct node_t { int type, lhs, rhs; } node;
        struct leaf_t { int type, value;    } leaf;
};

static const union cfd_trie_any_t
cfd_white_trie[] = {
        {{ /*   0 */ 1,     1, 188 }},
        {{ /*   1 */ 1,    79,   2 }},
        {{ /*   2 */ 1,     3,  42 }},
        {{ /*   3 */ 1,     4,  21 }},
        {{ /*   4 */ 1,     5,   6 }},
        {{ /*   5 */ 2,    11,   0 }},
        {{ /*   6 */ 1,     7,  12 }},
        {{ /*   7 */ 1,     8,   9 }},
        {{ /*   8 */ 2,    27,   0 }},
        {{ /*   9 */ 1,    10,  11 }},
        {{ /*  10 */ 2,    59,   0 }},
        {{ /*  11 */ 2,    60,   0 }},
        {{ /*  12 */ 1,    13,  20 }},
        {{ /*  13 */ 1,    14,  17 }},
        {{ /*  14 */ 1,    15,  16 }},
        {{ /*  15 */ 2,  1472,   0 }},
        {{ /*  16 */ 2,  1536,   0 }},
        {{ /*  17 */ 1,    18,  19 }},
        {{ /*  18 */ 2,  1600,   0 }},
        {{ /*  19 */ 2,  1728,   0 }},
        {{ /*  20 */ 2,    18,   0 }},
        {{ /*  21 */ 1,    22,  33 }},
        {{ /*  22 */ 1,    23,  28 }},
        {{ /*  23 */ 1,    24,  25 }},
        {{ /*  24 */ 2,    24,   0 }},
        {{ /*  25 */ 1,    26,  27 }},
        {{ /*  26 */ 2,    49,   0 }},
        {{ /*  27 */ 2,    50,   0 }},
        {{ /*  28 */ 1,    29,  32 }},
        {{ /*  29 */ 1,    30,  31 }},
        {{ /*  30 */ 2,    51,   0 }},
        {{ /*  31 */ 2,    52,   0 }},
        {{ /*  32 */ 2,    25,   0 }},
        {{ /*  33 */ 1,    34,  41 }},
        {{ /*  34 */ 1,    35,  38 }},
        {{ /*  35 */ 1,    36,  37 }},
        {{ /*  36 */ 2,    55,   0 }},
        {{ /*  37 */ 2,    56,   0 }},
        {{ /*  38 */ 1,    39,  40 }},
        {{ /*  39 */ 2,    57,   0 }},
        {{ /*  40 */ 2,    58,   0 }},
        {{ /*  41 */ 2,   192,   0 }},
        {{ /*  42 */ 1,    43,  78 }},
        {{ /*  43 */ 1,    44,  55 }},
        {{ /*  44 */ 1,    45,  46 }},
        {{ /*  45 */ 2,  1664,   0 }},
        {{ /*  46 */ 1,    47,  50 }},
        {{ /*  47 */ 1,    48,  49 }},
        {{ /*  48 */ 2,   448,   0 }},
        {{ /*  49 */ 2,   512,   0 }},
        {{ /*  50 */ 1,    51,  54 }},
        {{ /*  51 */ 1,    52,  53 }},
        {{ /*  52 */ 2,   704,   0 }},
        {{ /*  53 */ 2,   768,   0 }},
        {{ /*  54 */ 2,   640,   0 }},
        {{ /*  55 */ 1,    56,  69 }},
        {{ /*  56 */ 1,    57,  62 }},
        {{ /*  57 */ 1,    58,  59 }},
        {{ /*  58 */ 2,   576,   0 }},
        {{ /*  59 */ 1,    60,  61 }},
        {{ /*  60 */ 2,   832,   0 }},
        {{ /*  61 */ 2,   896,   0 }},
        {{ /*  62 */ 1,    63,  66 }},
        {{ /*  63 */ 1,    64,  65 }},
        {{ /*  64 */ 2,   960,   0 }},
        {{ /*  65 */ 2,  1024,   0 }},
        {{ /*  66 */ 1,    67,  68 }},
        {{ /*  67 */ 2,  1088,   0 }},
        {{ /*  68 */ 2,  1152,   0 }},
        {{ /*  69 */ 1,    70,  77 }},
        {{ /*  70 */ 1,    71,  74 }},
        {{ /*  71 */ 1,    72,  73 }},
        {{ /*  72 */ 2,  1216,   0 }},
        {{ /*  73 */ 2,  1280,   0 }},
        {{ /*  74 */ 1,    75,  76 }},
        {{ /*  75 */ 2,  1344,   0 }},
        {{ /*  76 */ 2,  1408,   0 }},
        {{ /*  77 */ 2,   256,   0 }},
        {{ /*  78 */ 2,     2,   0 }},
        {{ /*  79 */ 1,   117,  80 }},
        {{ /*  80 */ 1,    81, 102 }},
        {{ /*  81 */ 1,    82,  89 }},
        {{ /*  82 */ 1,    83,  84 }},
        {{ /*  83 */ 2,    12,   0 }},
        {{ /*  84 */ 1,    85,  88 }},
        {{ /*  85 */ 1,    86,  87 }},
        {{ /*  86 */ 2,    53,   0 }},
        {{ /*  87 */ 2,    54,   0 }},
        {{ /*  88 */ 2,    26,   0 }},
        {{ /*  89 */ 1,    90,  97 }},
        {{ /*  90 */ 1,    91,  94 }},
        {{ /*  91 */ 1,    92,  93 }},
        {{ /*  92 */ 2,    39,   0 }},
        {{ /*  93 */ 2,    40,   0 }},
        {{ /*  94 */ 1,    95,  96 }},
        {{ /*  95 */ 2,    41,   0 }},
        {{ /*  96 */ 2,    42,   0 }},
        {{ /*  97 */ 1,    98, 101 }},
        {{ /*  98 */ 1,    99, 100 }},
        {{ /*  99 */ 2,    43,   0 }},
        {{ /* 100 */ 2,    44,   0 }},
        {{ /* 101 */ 2,    21,   0 }},
        {{ /* 102 */ 1,   103, 116 }},
        {{ /* 103 */ 1,   104, 109 }},
        {{ /* 104 */ 1,   105, 106 }},
        {{ /* 105 */ 2,    28,   0 }},
        {{ /* 106 */ 1,   107, 108 }},
        {{ /* 107 */ 2,    61,   0 }},
        {{ /* 108 */ 2,    62,   0 }},
        {{ /* 109 */ 1,   110, 113 }},
        {{ /* 110 */ 1,   111, 112 }},
        {{ /* 111 */ 2,    63,   0 }},
        {{ /* 112 */ 2,     0,   0 }},
        {{ /* 113 */ 1,   114, 115 }},
        {{ /* 114 */ 2,   320,   0 }},
        {{ /* 115 */ 2,   384,   0 }},
        {{ /* 116 */ 2,    10,   0 }},
        {{ /* 117 */ 1,   139, 118 }},
        {{ /* 118 */ 1,   119, 132 }},
        {{ /* 119 */ 1,   120, 125 }},
        {{ /* 120 */ 1,   121, 122 }},
        {{ /* 121 */ 2,    20,   0 }},
        {{ /* 122 */ 1,   123, 124 }},
        {{ /* 123 */ 2,    33,   0 }},
        {{ /* 124 */ 2,    34,   0 }},
        {{ /* 125 */ 1,   126, 129 }},
        {{ /* 126 */ 1,   127, 128 }},
        {{ /* 127 */ 2,    35,   0 }},
        {{ /* 128 */ 2,    36,   0 }},
        {{ /* 129 */ 1,   130, 131 }},
        {{ /* 130 */ 2,    37,   0 }},
        {{ /* 131 */ 2,    38,   0 }},
        {{ /* 132 */ 1,   133, 138 }},
        {{ /* 133 */ 1,   134, 135 }},
        {{ /* 134 */ 2,    19,   0 }},
        {{ /* 135 */ 1,   136, 137 }},
        {{ /* 136 */ 2,    31,   0 }},
        {{ /* 137 */ 2,    32,   0 }},
        {{ /* 138 */ 2,     1,   0 }},
        {{ /* 139 */ 1,   147, 140 }},
        {{ /* 140 */ 1,   141, 146 }},
        {{ /* 141 */ 1,   142, 143 }},
        {{ /* 142 */ 2,    23,   0 }},
        {{ /* 143 */ 1,   144, 145 }},
        {{ /* 144 */ 2,    47,   0 }},
        {{ /* 145 */ 2,    48,   0 }},
        {{ /* 146 */ 2,    13,   0 }},
        {{ /* 147 */ 1,   153, 148 }},
        {{ /* 148 */ 1,   149, 152 }},
        {{ /* 149 */ 1,   150, 151 }},
        {{ /* 150 */ 2,    45,   0 }},
        {{ /* 151 */ 2,    46,   0 }},
        {{ /* 152 */ 2,    22,   0 }},
        {{ /* 153 */ 1,   157, 154 }},
        {{ /* 154 */ 1,   155, 156 }},
        {{ /* 155 */ 2,    29,   0 }},
        {{ /* 156 */ 2,    30,   0 }},
        {{ /* 157 */ 1,   183, 158 }},
        {{ /* 158 */ 1,   159, 162 }},
        {{ /* 159 */ 1,   160, 169 }},
        {{ /* 160 */ 1,   161, 166 }},
        {{ /* 161 */ 2,  1792,   0 }},
        {{ /* 162 */ 1,   163, 176 }},
        {{ /* 163 */ 1,   164, 165 }},
        {{ /* 164 */ 2,  1856,   0 }},
        {{ /* 165 */ 2,  1920,   0 }},
        {{ /* 166 */ 1,   167, 168 }},
        {{ /* 167 */ 2,  1984,   0 }},
        {{ /* 168 */ 2,  2048,   0 }},
        {{ /* 169 */ 1,   170, 173 }},
        {{ /* 170 */ 1,   171, 172 }},
        {{ /* 171 */ 2,  2112,   0 }},
        {{ /* 172 */ 2,  2176,   0 }},
        {{ /* 173 */ 1,   174, 175 }},
        {{ /* 174 */ 2,  2240,   0 }},
        {{ /* 175 */ 2,  2304,   0 }},
        {{ /* 176 */ 1,   177, 180 }},
        {{ /* 177 */ 1,   178, 179 }},
        {{ /* 178 */ 2,  2368,   0 }},
        {{ /* 179 */ 2,  2432,   0 }},
        {{ /* 180 */ 1,   181, 182 }},
        {{ /* 181 */ 2,  2496,   0 }},
        {{ /* 182 */ 2,  2560,   0 }},
        {{ /* 183 */ 1,   184,   0 }},
        {{ /* 184 */ 1,   185,   0 }},
        {{ /* 185 */ 1,   186,   0 }},
        {{ /* 186 */ 1,     0, 187 }},
        {{ /* 187 */ 2,    -1,   0 }},
        {{ /* 188 */ 1,   189, 202 }},
        {{ /* 189 */ 1,   190, 195 }},
        {{ /* 190 */ 1,   191, 192 }},
        {{ /* 191 */ 2,     3,   0 }},
        {{ /* 192 */ 1,   193, 194 }},
        {{ /* 193 */ 2,   128,   0 }},
        {{ /* 194 */ 2,     8,   0 }},
        {{ /* 195 */ 1,   196, 201 }},
        {{ /* 196 */ 1,   197, 198 }},
        {{ /* 197 */ 2,     9,   0 }},
        {{ /* 198 */ 1,   199, 200 }},
        {{ /* 199 */ 2,    16,   0 }},
        {{ /* 200 */ 2,    17,   0 }},
        {{ /* 201 */ 2,     4,   0 }},
        {{ /* 202 */ 1,   203, 210 }},
        {{ /* 203 */ 1,   204, 205 }},
        {{ /* 204 */ 2,     5,   0 }},
        {{ /* 205 */ 1,   206, 209 }},
        {{ /* 206 */ 1,   207, 208 }},
        {{ /* 207 */ 2,    14,   0 }},
        {{ /* 208 */ 2,    15,   0 }},
        {{ /* 209 */ 2,    64,   0 }},
        {{ /* 210 */ 1,   211, 212 }},
        {{ /* 211 */ 2,     6,   0 }},
        {{ /* 212 */ 2,     7,   0 }},
};

static const union cfd_trie_any_t
cfd_black_trie[] = {
        {{ /*   0 */ 1,     1, 210 }},
        {{ /*   1 */ 1,     5,   2 }},
        {{ /*   2 */ 1,     4,   3 }},
        {{ /*   3 */ 2,     4,   0 }},
        {{ /*   4 */ 2,     1,   0 }},
        {{ /*   5 */ 1,     9,   6 }},
        {{ /*   6 */ 1,     8,   7 }},
        {{ /*   7 */ 2,     5,   0 }},
        {{ /*   8 */ 2,     6,   0 }},
        {{ /*   9 */ 1,    15,  10 }},
        {{ /*  10 */ 1,    12,  11 }},
        {{ /*  11 */ 2,     7,   0 }},
        {{ /*  12 */ 1,    14,  13 }},
        {{ /*  13 */ 2,     8,   0 }},
        {{ /*  14 */ 2,     9,   0 }},
        {{ /*  15 */ 1,    59,  16 }},
        {{ /*  16 */ 1,    17,  20 }},
        {{ /*  17 */ 1,    18,  19 }},
        {{ /*  18 */ 2,    10,   0 }},
        {{ /*  19 */ 2,    11,   0 }},
        {{ /*  20 */ 1,    21,  58 }},
        {{ /*  21 */ 1,    22,  37 }},
        {{ /*  22 */ 1,    23,  24 }},
        {{ /*  23 */ 2,    15,   0 }},
        {{ /*  24 */ 1,    25,  32 }},
        {{ /*  25 */ 1,    26,  29 }},
        {{ /*  26 */ 1,    27,  28 }},
        {{ /*  27 */ 2,   128,   0 }},
        {{ /*  28 */ 2,   192,   0 }},
        {{ /*  29 */ 1,    30,  31 }},
        {{ /*  30 */ 2,    26,   0 }},
        {{ /*  31 */ 2,    27,   0 }},
        {{ /*  32 */ 1,    33,  36 }},
        {{ /*  33 */ 1,    34,  35 }},
        {{ /*  34 */ 2,    28,   0 }},
        {{ /*  35 */ 2,    29,   0 }},
        {{ /*  36 */ 2,    19,   0 }},
        {{ /*  37 */ 1,    38,  51 }},
        {{ /*  38 */ 1,    39,  44 }},
        {{ /*  39 */ 1,    40,  41 }},
        {{ /*  40 */ 2,    20,   0 }},
        {{ /*  41 */ 1,    42,  43 }},
        {{ /*  42 */ 2,    34,   0 }},
        {{ /*  43 */ 2,    35,   0 }},
        {{ /*  44 */ 1,    45,  48 }},
        {{ /*  45 */ 1,    46,  47 }},
        {{ /*  46 */ 2,    36,   0 }},
        {{ /*  47 */ 2,    37,   0 }},
        {{ /*  48 */ 1,    49,  50 }},
        {{ /*  49 */ 2,    38,   0 }},
        {{ /*  50 */ 2,    39,   0 }},
        {{ /*  51 */ 1,    52,  57 }},
        {{ /*  52 */ 1,    53,  54 }},
        {{ /*  53 */ 2,    21,   0 }},
        {{ /*  54 */ 1,    55,  56 }},
        {{ /*  55 */ 2,    42,   0 }},
        {{ /*  56 */ 2,    43,   0 }},
        {{ /*  57 */ 2,     0,   0 }},
        {{ /*  58 */ 2,    12,   0 }},
        {{ /*  59 */ 1,   111,  60 }},
        {{ /*  60 */ 1,    86,  61 }},
        {{ /*  61 */ 1,    63,  62 }},
        {{ /*  62 */ 2,    14,   0 }},
        {{ /*  63 */ 1,    77,  64 }},
        {{ /*  64 */ 1,    70,  65 }},
        {{ /*  65 */ 1,    67,  66 }},
        {{ /*  66 */ 2,    22,   0 }},
        {{ /*  67 */ 1,    69,  68 }},
        {{ /*  68 */ 2,    41,   0 }},
        {{ /*  69 */ 2,    40,   0 }},
        {{ /*  70 */ 1,    74,  71 }},
        {{ /*  71 */ 1,    73,  72 }},
        {{ /*  72 */ 2,    33,   0 }},
        {{ /*  73 */ 2,    32,   0 }},
        {{ /*  74 */ 1,    76,  75 }},
        {{ /*  75 */ 2,    31,   0 }},
        {{ /*  76 */ 2,    30,   0 }},
        {{ /*  77 */ 1,    85,  78 }},
        {{ /*  78 */ 1,    82,  79 }},
        {{ /*  79 */ 1,    81,  80 }},
        {{ /*  80 */ 2,    63,   0 }},
        {{ /*  81 */ 2,    62,   0 }},
        {{ /*  82 */ 1,    84,  83 }},
        {{ /*  83 */ 2,    49,   0 }},
        {{ /*  84 */ 2,    48,   0 }},
        {{ /*  85 */ 2,    17,   0 }},
        {{ /*  86 */ 1,   110,  87 }},
        {{ /*  87 */ 1,    97,  88 }},
        {{ /*  88 */ 1,    90,  89 }},
        {{ /*  89 */ 2,    16,   0 }},
        {{ /*  90 */ 1,    94,  91 }},
        {{ /*  91 */ 1,    93,  92 }},
        {{ /*  92 */ 2,   256,   0 }},
        {{ /*  93 */ 2,    61,   0 }},
        {{ /*  94 */ 1,    96,  95 }},
        {{ /*  95 */ 2,    58,   0 }},
        {{ /*  96 */ 2,    57,   0 }},
        {{ /*  97 */ 1,   105,  98 }},
        {{ /*  98 */ 1,   102,  99 }},
        {{ /*  99 */ 1,   101, 100 }},
        {{ /* 100 */ 2,    47,   0 }},
        {{ /* 101 */ 2,    46,   0 }},
        {{ /* 102 */ 1,   104, 103 }},
        {{ /* 103 */ 2,    45,   0 }},
        {{ /* 104 */ 2,    44,   0 }},
        {{ /* 105 */ 1,   109, 106 }},
        {{ /* 106 */ 1,   108, 107 }},
        {{ /* 107 */ 2,    51,   0 }},
        {{ /* 108 */ 2,    50,   0 }},
        {{ /* 109 */ 2,    23,   0 }},
        {{ /* 110 */ 2,    13,   0 }},
        {{ /* 111 */ 1,   179, 112 }},
        {{ /* 112 */ 1,   146, 113 }},
        {{ /* 113 */ 1,   129, 114 }},
        {{ /* 114 */ 1,   116, 115 }},
        {{ /* 115 */ 2,    64,   0 }},
        {{ /* 116 */ 1,   124, 117 }},
        {{ /* 117 */ 1,   121, 118 }},
        {{ /* 118 */ 1,   120, 119 }},
        {{ /* 119 */ 2,  1216,   0 }},
        {{ /* 120 */ 2,  1152,   0 }},
        {{ /* 121 */ 1,   123, 122 }},
        {{ /* 122 */ 2,  1088,   0 }},
        {{ /* 123 */ 2,  1024,   0 }},
        {{ /* 124 */ 1,   128, 125 }},
        {{ /* 125 */ 1,   127, 126 }},
        {{ /* 126 */ 2,   960,   0 }},
        {{ /* 127 */ 2,   896,   0 }},
        {{ /* 128 */ 2,    54,   0 }},
        {{ /* 129 */ 1,   139, 130 }},
        {{ /* 130 */ 1,   136, 131 }},
        {{ /* 131 */ 1,   133, 132 }},
        {{ /* 132 */ 2,    53,   0 }},
        {{ /* 133 */ 1,   135, 134 }},
        {{ /* 134 */ 2,   576,   0 }},
        {{ /* 135 */ 2,   512,   0 }},
        {{ /* 136 */ 1,   138, 137 }},
        {{ /* 137 */ 2,   448,   0 }},
        {{ /* 138 */ 2,   384,   0 }},
        {{ /* 139 */ 1,   145, 140 }},
        {{ /* 140 */ 1,   142, 141 }},
        {{ /* 141 */ 2,   320,   0 }},
        {{ /* 142 */ 1,   144, 143 }},
        {{ /* 143 */ 2,  1728,   0 }},
        {{ /* 144 */ 2,  1664,   0 }},
        {{ /* 145 */ 2,    25,   0 }},
        {{ /* 146 */ 1,   166, 147 }},
        {{ /* 147 */ 1,   155, 148 }},
        {{ /* 148 */ 1,   150, 149 }},
        {{ /* 149 */ 2,    24,   0 }},
        {{ /* 150 */ 1,   154, 151 }},
        {{ /* 151 */ 1,   153, 152 }},
        {{ /* 152 */ 2,  1600,   0 }},
        {{ /* 153 */ 2,  1536,   0 }},
        {{ /* 154 */ 2,    60,   0 }},
        {{ /* 155 */ 1,   161, 156 }},
        {{ /* 156 */ 1,   158, 157 }},
        {{ /* 157 */ 2,    59,   0 }},
        {{ /* 158 */ 1,   160, 159 }},
        {{ /* 159 */ 2,  1472,   0 }},
        {{ /* 160 */ 2,  1408,   0 }},
        {{ /* 161 */ 1,   165, 162 }},
        {{ /* 162 */ 1,   164, 163 }},
        {{ /* 163 */ 2,  1344,   0 }},
        {{ /* 164 */ 2,  1280,   0 }},
        {{ /* 165 */ 2,    56,   0 }},
        {{ /* 166 */ 1,   178, 167 }},
        {{ /* 167 */ 1,   173, 168 }},
        {{ /* 168 */ 1,   170, 169 }},
        {{ /* 169 */ 2,    55,   0 }},
        {{ /* 170 */ 1,   172, 171 }},
        {{ /* 171 */ 2,   832,   0 }},
        {{ /* 172 */ 2,   768,   0 }},
        {{ /* 173 */ 1,   177, 174 }},
        {{ /* 174 */ 1,   176, 175 }},
        {{ /* 175 */ 2,   704,   0 }},
        {{ /* 176 */ 2,   640,   0 }},
        {{ /* 177 */ 2,    52,   0 }},
        {{ /* 178 */ 2,    18,   0 }},
        {{ /* 179 */ 1,   205, 180 }},
        {{ /* 180 */ 1,   192, 181 }},
        {{ /* 181 */ 1,   189, 182 }},
        {{ /* 182 */ 1,   186, 183 }},
        {{ /* 183 */ 1,   185, 184 }},
        {{ /* 184 */ 2,  2560,   0 }},
        {{ /* 185 */ 2,  2496,   0 }},
        {{ /* 186 */ 1,   188, 187 }},
        {{ /* 187 */ 2,  2432,   0 }},
        {{ /* 188 */ 2,  2368,   0 }},
        {{ /* 189 */ 1,   191, 190 }},
        {{ /* 190 */ 2,  1920,   0 }},
        {{ /* 191 */ 2,  1856,   0 }},
        {{ /* 192 */ 1,   200, 193 }},
        {{ /* 193 */ 1,   197, 194 }},
        {{ /* 194 */ 1,   196, 195 }},
        {{ /* 195 */ 2,  2304,   0 }},
        {{ /* 196 */ 2,  2240,   0 }},
        {{ /* 197 */ 1,   199, 198 }},
        {{ /* 198 */ 2,  2176,   0 }},
        {{ /* 199 */ 2,  2112,   0 }},
        {{ /* 200 */ 1,   204, 201 }},
        {{ /* 201 */ 1,   203, 202 }},
        {{ /* 202 */ 2,  2048,   0 }},
        {{ /* 203 */ 2,  1984,   0 }},
        {{ /* 204 */ 2,  1792,   0 }},
        {{ /* 205 */ 1,   206,   0 }},
        {{ /* 206 */ 1,   207,   0 }},
        {{ /* 207 */ 1,   208,   0 }},
        {{ /* 208 */ 1,     0, 209 }},
        {{ /* 209 */ 2,    -1,   0 }},
        {{ /* 210 */ 1,   212, 211 }},
        {{ /* 211 */ 2,     2,   0 }},
        {{ /* 212 */ 2,     3,   0 }},
};

static const union cfd_trie_any_t *tries[] = {
        cfd_black_trie, cfd_white_trie
};

void
cfd_trie_init(struct cfd_trie_state_t *state, int color)
{
        *state = (struct cfd_trie_state_t){ !!color, 0 };
}

int
cfd_trie_walk(struct cfd_trie_state_t *state, int symbol)
{
        const union cfd_trie_any_t *any;

        assert(state);
        assert(0 == state->color || 1 == state->color);
        assert(0 == symbol || 1 == symbol);

        any = &tries[state->color][state->state];
        if (CFD_TRIE_NODE == any->type) {
                int newstate = 0 == symbol
                        ? any->node.lhs : any->node.rhs;

                if (newstate) {
                        state->state = newstate;
                        return 1;
                }
        }

        return 0;
}

int
cfd_trie_is_terminal(struct cfd_trie_state_t *state)
{
        assert(state);
        assert(0 == state->color || 1 == state->color);

        return CFD_TRIE_LEAF == tries[state->color][state->state].type;
}

void
cfd_trie_get_value(struct cfd_trie_state_t *state, int *value)
{
        const union cfd_trie_any_t *trie;

        assert(state);
        assert(0 == state->color || 1 == state->color);

        trie = tries[state->color];
        assert(CFD_TRIE_LEAF == trie[state->state].type);

        *value = trie[state->state].leaf.value;
}
